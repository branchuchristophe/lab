---
import ChatIcon from './icons/ChatIcon.astro';
import GitHubIcon from './icons/GitHubIcon.astro';
import NotebookIcon from './icons/NotebookIcon.astro';
import XIcon from './icons/XIcon.astro';
import LinkedInIcon from './icons/LinkedInIcon.astro';
import CopyIcon from './icons/CopyIcon.astro';
import {
  generateClaudeUrl,
  generateChatGPTUrl,
  generateXShareUrl,
  generateLinkedInShareUrl,
} from '../lib/utils';

interface Props {
  title: string;
  description: string;
  articleUrl: string;
  claudeUrl?: string;
  chatgptUrl?: string;
  githubUrl?: string;
  notebookUrl?: string;
}

const { title, description, articleUrl, claudeUrl, chatgptUrl, githubUrl, notebookUrl } =
  Astro.props;

const finalClaudeUrl = claudeUrl || generateClaudeUrl(title, articleUrl, description);
const finalChatGPTUrl = chatgptUrl || generateChatGPTUrl(title, articleUrl, description);
const xShareUrl = generateXShareUrl(title, description, articleUrl);
const linkedInShareUrl = generateLinkedInShareUrl(articleUrl);
---

<div class="border-t border-b border-neutral-800 py-8 my-12">
  <div class="space-y-6">
    <!-- Agent Actions Section -->
    <div>
      <h3 class="text-lg font-semibold mb-3 text-neutral-200">Read with AI</h3>
      <div class="flex flex-wrap gap-3">
        <a
          href={finalClaudeUrl}
          target="_blank"
          rel="noopener noreferrer"
          class="inline-flex items-center gap-2 px-4 py-2 bg-primary-500/10 border border-primary-500/30 rounded-lg hover:bg-primary-500/20 hover:border-primary-500/50 transition-colors text-primary-400"
        >
          <ChatIcon />
          <span>Claude</span>
        </a>

        <a
          href={finalChatGPTUrl}
          target="_blank"
          rel="noopener noreferrer"
          class="inline-flex items-center gap-2 px-4 py-2 bg-green-500/10 border border-green-500/30 rounded-lg hover:bg-green-500/20 hover:border-green-500/50 transition-colors text-green-400"
        >
          <ChatIcon />
          <span>ChatGPT</span>
        </a>

        {
          githubUrl && (
            <a
              href={githubUrl}
              target="_blank"
              rel="noopener noreferrer"
              class="inline-flex items-center gap-2 px-4 py-2 bg-neutral-800/50 border border-neutral-700 rounded-lg hover:bg-neutral-800 hover:border-neutral-600 transition-colors text-neutral-300"
            >
              <GitHubIcon />
              <span>View Code</span>
            </a>
          )
        }

        {
          notebookUrl && (
            <a
              href={notebookUrl}
              target="_blank"
              rel="noopener noreferrer"
              class="inline-flex items-center gap-2 px-4 py-2 bg-blue-500/10 border border-blue-500/30 rounded-lg hover:bg-blue-500/20 hover:border-blue-500/50 transition-colors text-blue-400"
            >
              <NotebookIcon />
              <span>Notebook</span>
            </a>
          )
        }
      </div>
    </div>

    <!-- Share Section -->
    <div>
      <h3 class="text-lg font-semibold mb-3 text-neutral-200">Share</h3>
      <div class="flex flex-wrap gap-3">
        <a
          href={xShareUrl}
          target="_blank"
          rel="noopener noreferrer"
          class="inline-flex items-center gap-2 px-4 py-2 bg-neutral-800/50 border border-neutral-700 rounded-lg hover:bg-neutral-800 hover:border-neutral-600 transition-colors text-neutral-300"
        >
          <XIcon />
          <span>X</span>
        </a>

        <a
          href={linkedInShareUrl}
          target="_blank"
          rel="noopener noreferrer"
          class="inline-flex items-center gap-2 px-4 py-2 bg-neutral-800/50 border border-neutral-700 rounded-lg hover:bg-neutral-800 hover:border-neutral-600 transition-colors text-neutral-300"
        >
          <LinkedInIcon />
          <span>LinkedIn</span>
        </a>

        <button
          id="copy-link-btn"
          data-url={articleUrl}
          class="inline-flex items-center gap-2 px-4 py-2 bg-neutral-800/50 border border-neutral-700 rounded-lg hover:bg-neutral-800 hover:border-neutral-600 transition-colors text-neutral-300"
        >
          <CopyIcon />
          <span>Copy Link</span>
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  const copyBtn = document.getElementById('copy-link-btn');
  if (copyBtn) {
    copyBtn.addEventListener('click', async () => {
      const url = copyBtn.getAttribute('data-url');
      if (!url) return;

      try {
        await navigator.clipboard.writeText(url);
        const textSpan = copyBtn.querySelector('span');
        if (textSpan) {
          const prevText = textSpan.textContent;
          textSpan.textContent = 'Copied!';
          setTimeout(() => {
            textSpan.textContent = prevText;
          }, 2000);
        }
      } catch (err) {
        console.error('Failed to copy:', err);
      }
    });
  }
</script>
