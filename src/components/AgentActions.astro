---
import {
  generateClaudeUrl,
  generateChatGPTUrl,
  generateXShareUrl,
  generateLinkedInShareUrl,
} from '../lib/utils';

interface Props {
  title: string;
  description: string;
  articleUrl: string;
  claudeUrl?: string;
  chatgptUrl?: string;
  githubUrl?: string;
  notebookUrl?: string;
}

const { title, description, articleUrl, claudeUrl, chatgptUrl, githubUrl, notebookUrl } =
  Astro.props;

const finalClaudeUrl = claudeUrl || generateClaudeUrl(title, articleUrl, description);
const finalChatGPTUrl = chatgptUrl || generateChatGPTUrl(title, articleUrl, description);
const xShareUrl = generateXShareUrl(title, description, articleUrl);
const linkedInShareUrl = generateLinkedInShareUrl(articleUrl);
---

<div class="border-t border-b border-neutral-200 dark:border-neutral-800 py-8 my-12 font-mono text-sm">
  <div class="space-y-6">
    <!-- Agent Actions Section -->
    <div>
      <div class="flex flex-wrap items-center gap-3">
        <span class="text-neutral-600 dark:text-neutral-500">$</span>
        <span class="text-neutral-600 dark:text-neutral-500">read --with</span>
        <a
          href={finalClaudeUrl}
          target="_blank"
          rel="noopener noreferrer"
          class="inline-flex items-center gap-1.5 px-2 py-1 bg-primary-500/10 border border-primary-500/30 rounded hover:bg-primary-500/20 transition-colors text-primary-400 no-underline"
        >
          claude
        </a>
        <a
          href={finalChatGPTUrl}
          target="_blank"
          rel="noopener noreferrer"
          class="inline-flex items-center gap-1.5 px-2 py-1 bg-green-500/10 border border-green-500/30 rounded hover:bg-green-500/20 transition-colors text-green-400 no-underline"
        >
          chatgpt
        </a>
        {
          githubUrl && (
            <a
              href={githubUrl}
              target="_blank"
              rel="noopener noreferrer"
              class="inline-flex items-center gap-1.5 px-2 py-1 bg-neutral-100 dark:bg-neutral-800/50 border border-neutral-300 dark:border-neutral-700 rounded hover:bg-neutral-200 dark:hover:bg-neutral-800 transition-colors text-neutral-700 dark:text-neutral-300 no-underline"
            >
              code
            </a>
          )
        }
        {
          notebookUrl && (
            <a
              href={notebookUrl}
              target="_blank"
              rel="noopener noreferrer"
              class="inline-flex items-center gap-1.5 px-2 py-1 bg-blue-500/10 border border-blue-500/30 rounded hover:bg-blue-500/20 transition-colors text-blue-400 no-underline"
            >
              notebook
            </a>
          )
        }
      </div>
    </div>

    <!-- Share Section -->
    <div>
      <div class="flex flex-wrap items-center gap-3">
        <span class="text-neutral-600 dark:text-neutral-500">$</span>
        <span class="text-neutral-600 dark:text-neutral-500">share --to</span>
        <a
          href={xShareUrl}
          target="_blank"
          rel="noopener noreferrer"
          class="inline-flex items-center gap-1.5 px-2 py-1 bg-neutral-100 dark:bg-neutral-800/50 border border-neutral-300 dark:border-neutral-700 rounded hover:bg-neutral-200 dark:hover:bg-neutral-800 transition-colors text-neutral-700 dark:text-neutral-300 no-underline"
        >
          x
        </a>
        <a
          href={linkedInShareUrl}
          target="_blank"
          rel="noopener noreferrer"
          class="inline-flex items-center gap-1.5 px-2 py-1 bg-neutral-100 dark:bg-neutral-800/50 border border-neutral-300 dark:border-neutral-700 rounded hover:bg-neutral-200 dark:hover:bg-neutral-800 transition-colors text-neutral-700 dark:text-neutral-300 no-underline"
        >
          linkedin
        </a>
        <button
          id="copy-link-btn"
          data-url={articleUrl}
          class="inline-flex items-center gap-1.5 px-2 py-1 bg-neutral-100 dark:bg-neutral-800/50 border border-neutral-300 dark:border-neutral-700 rounded hover:bg-neutral-200 dark:hover:bg-neutral-800 transition-colors text-neutral-700 dark:text-neutral-300"
        >
          copy
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  const copyBtn = document.getElementById('copy-link-btn');
  if (copyBtn) {
    copyBtn.addEventListener('click', async () => {
      const url = copyBtn.getAttribute('data-url');
      if (!url) return;

      try {
        await navigator.clipboard.writeText(url);
        const textSpan = copyBtn.querySelector('span');
        if (textSpan) {
          const prevText = textSpan.textContent;
          textSpan.textContent = 'Copied!';
          setTimeout(() => {
            textSpan.textContent = prevText;
          }, 2000);
        }
      } catch (err) {
        console.error('Failed to copy:', err);
      }
    });
  }
</script>
